<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QFSL Compliance Intake</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://quintrin.github.io/Quintrin-astro/styles.css">
</head>

<body>

<header>
<div class="nav">
<div class="logo">QUINTRIN</div>
</div>
</header>

<main class="container">

<section>
<h1>QFSL Compliance Intake</h1>

<label>Document Ref</label>
<input id="documentRef" readonly>

<label>Date</label>
<input id="docDate" type="date" readonly>
</section>

<section>
<h2>Seller Entity</h2>

<label>Legal Name</label>
<input name="legal_name">

<label>Country</label>
<input name="country">

<label>Registration Number</label>
<input name="registration_number">

<label>TIN</label>
<input name="tin">

<label>Representative Name</label>
<input name="rep_name">

<label>Email</label>
<input name="rep_email">

<label>Transaction Value USD</label>
<input name="transaction_value">

<label>Source of Funds</label>
<textarea name="source_of_funds"></textarea>

<label>Source of Wealth</label>
<textarea name="source_of_wealth"></textarea>
</section>

<button class="cta" onclick="submitIntake()">Submit Intake</button>

<!-- INVESTOR PANEL HIDDEN -->
<section id="investorSection" class="investor-panel">
<h2>Investor Panel</h2>
<input id="dealRef" readonly>
<textarea id="note"></textarea>

<button onclick="submitDecision('Approved')">Approve</button>
<button onclick="submitDecision('Rejected')">Reject</button>
</section>

<button class="investor-btn" onclick="unlockInvestor()">Investor Access</button>

</main>

<footer>
<p>Quintrin Independent Structuring Platform</p>
</footer>

<script>
const API = "https://script.google.com/macros/s/AKfycbwMqFyO3pVZbvOfhSt1DMUObfHAeyqNBxTlLZjXOMdqJo6xc8DzILMec_YVjrXbjo8/exec";

// AUTO REF
window.onload = () => {
  fetch(API).then(r=>r.text()).then(ref=>{
    document.getElementById("documentRef").value = ref;
    document.getElementById("dealRef").value = ref;
  });

  document.getElementById("docDate").value = new Date().toISOString().split("T")[0];
};

// SELLER SUBMIT
function submitIntake(){
  const payload = {
    documentRef: document.getElementById("documentRef").value,
    dealRef: document.getElementById("dealRef").value,
    legal_name: document.querySelector("[name='legal_name']").value,
    country: document.querySelector("[name='country']").value,
    registration_number: document.querySelector("[name='registration_number']").value,
    tin: document.querySelector("[name='tin']").value,
    rep_name: document.querySelector("[name='rep_name']").value,
    rep_email: document.querySelector("[name='rep_email']").value,
    transaction_value: document.querySelector("[name='transaction_value']").value,
    source_of_funds: document.querySelector("[name='source_of_funds']").value,
    source_of_wealth: document.querySelector("[name='source_of_wealth']").value
  };

  fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})
  .then(()=>alert("Intake Logged"))
  .catch(e=>alert("Error "+e));
}

// INVESTOR LOCK
const PIN="4821";
function unlockInvestor(){
  const p=prompt("Investor PIN");
  if(p===PIN) document.getElementById("investorSection").style.display="block";
}

// INVESTOR DECISION
function submitDecision(status){
  fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      ref:document.getElementById("documentRef").value,
      status:status,
      notes:document.getElementById("note").value,
      code:"Verified"
    })
  }).then(()=>alert("Decision Logged"));
}
</script>

</body>
</html>
